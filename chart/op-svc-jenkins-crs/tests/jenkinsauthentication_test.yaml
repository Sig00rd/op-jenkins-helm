suite: test JenkinsAuthentication
templates:
  - jenkins_authentication.yaml
tests:
  - it: should propagate all the declared metadata fields
    values:
      - values/jenkinsauthentication_githubtest_values.yaml
    asserts:
      - isAPIVersion:
          of: operator-service.com/v1beta1
      - isKind:
          of: JenkinsAuthentication
      - equal:
          path: metadata.name
          value: authentication
      - equal:
          path: metadata.namespace
          value: null
      - equal:
          path: metadata.labels
          value:
            operator-service.com/jenkins: jenkins
      - equal:
          path: metadata.annotations
          value:
            annotationsTestKey: annotationsTestValue
  - it: should propagate all the declared githubOAuth spec fields
    values:
      - values/jenkinsauthentication_githubtest_values.yaml
    asserts:
      - equal:
          path: spec.type
          value: githubOAuth
      - equal:
          path: spec.githubOAuth.clientID
          value: testClientID
      - equal:
          path: spec.githubOAuth.clientSecretRef.name
          value: secret
      - equal:
          path: spec.githubOAuth.clientSecretRef.namespace
          value: default
      - equal:
          path: spec.githubOAuth.webUri
          value: "https://github.com"
      - equal:
          path: spec.githubOAuth.apiUri
          value: "https://api.github.com"
      - contains:
          path: spec.githubOAuth.scopes
          content:
            read:org
      - contains:
          path: spec.githubOAuth.scopes
          content:
            user:email
      - isNull:
          path: spec.googleOAuth
  - it: should propagate all the declared googleOAuth spec fields
    values:
      - values/jenkinsauthentication_googletest_values.yaml
    asserts:
      - equal:
          path: spec.type
          value: googleOAuth
      - equal:
          path: spec.googleOAuth.clientID
          value: testClientID
      - equal:
          path: spec.googleOAuth.clientSecretRef.name
          value: secret
      - equal:
          path: spec.googleOAuth.clientSecretRef.namespace
          value: default
      - equal:
          path: spec.googleOAuth.domain
          value: myTestDomain
      - isNull:
          path: spec.githubOAuth